cmake_minimum_required(VERSION 2.8)
project(bsplines)

option(BSPLINE_BUILD_QT             "Build the Qt application"    OFF)
option(BSPLINE_BUILD_UNIT_TESTS     "Build test using Boost.Test" OFF)

# MSVC 2012 has C++11 enabled by default
if (UNIX)
    add_definitions(-std=c++11)
endif()
add_executable(bspline_demo
               bspline.hpp
               demo.cpp
               )

# No need for find_package for Eigen3 since it is header-only
set(EIGEN3_INCLUDE_DIRS "" CACHE PATH "Include dir for Eigen3")
include_directories(${EIGEN3_INCLUDE_DIRS})

if (BSPLINE_BUILD_UNIT_TESTS)
    # Handle Boost
    find_package(Boost 1.45 COMPONENTS unit_test_framework REQUIRED)
    include_directories(${Boost_INCLUDE_DIRS})
    add_executable(tests tests.cpp)
    target_link_libraries(tests ${Boost_LIBRARIES})
endif()

if (BSPLINE_BUILD_QT)
    # Handle OpenGL and GLU.
    find_package(OpenGL REQUIRED)
    include_directories(${OPENGL_INCLUDE_DIR})
    if (NOT ${OPENGL_GLU_FOUND})
        message(ERROR "GLU not found!")
    endif()

    # Handle Qt
    set(QT_USE_QTOPENGL TRUE)
    find_package(Qt4 REQUIRED)
    set(qtapp_SOURCES qtapp.cpp MyMainWindow.cpp QTweakWindow.cpp)
    set(qtapp_HEADERS MyMainWindow.hpp QTweakWindow.hpp VariableEditorWidget.hpp)
    # The header files generated by uic are needed as we need to build
    # a dependency between them and the final executable. Otherwise they will not
    # be created.
    # To invoke moc. Assigns names of the resulting files to the variable listed first.
    qt4_wrap_cpp(qtapp_HEADERS_MOC ${qtapp_HEADERS})
    include(${QT_USE_FILE})
    
    set(CMAKE_MODULE_PATH ${CMAKE_MODULE_PATH} "${CMAKE_SOURCE_DIR}/cmake")
    find_package(Qwt REQUIRED)
    if (NOT ${QWT_FOUND})
        message(ERROR "Qwt library not found!")
    endif()
    include_directories(${QWT_INCLUDE_DIRS})
        
    # Make main executable
    add_executable(qtdemo bspline.hpp ${qtapp_SOURCES} ${qtapp_HEADERS_MOC})

    target_link_libraries(qtdemo
                          ${QT_LIBRARIES}
                          ${QWT_LIBRARIES}
                          ${OPENGL_LIBRARIES}
                          )    
endif()
